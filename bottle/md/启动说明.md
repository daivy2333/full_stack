# 漂流瓶项目启动说明

本文档详细说明了如何启动漂流瓶项目的前端、后端和数据库。

## 环境要求

- Node.js (v14或更高版本)
- MySQL数据库 (v5.7或更高版本)
- npm或yarn包管理器

## 1. 数据库设置

### 1.1 安装MySQL

如果您尚未安装MySQL，请根据您的操作系统下载并安装：
- Windows: [MySQL官方下载](https://dev.mysql.com/downloads/mysql/)
- macOS: `brew install mysql`
- Ubuntu/Debian: `sudo apt-get install mysql-server`

### 1.2 创建数据库和表


## 2. 后端服务启动

### 2.1 WSL环境特殊说明

如果您在WSL(Windows Subsystem for Linux)环境中运行项目，请确保:

1. 使用Linux风格的路径，而不是Windows路径
2. 在WSL终端中运行命令，而不是Windows CMD
3. 如果您已经在Windows CMD中，请先进入WSL:
   ```bash
   wsl
   ```
4. 在WSL中导航到项目目录:
   ```bash
   cd /home/daivy/projects/full_stack/bottle/backend
   ```

### 2.2 安装依赖

1. 进入后端目录:
```bash
cd /home/daivy/projects/full_stack/bottle/backend
```

2. 安装依赖:
```bash
npm install
```

### 2.2 配置环境变量

在backend目录下创建`.env`文件，添加以下内容:
```
DB_HOST=localhost
DB_USER=drift_app
DB_PASSWORD=drift_password
DB_NAME=drift_bottle
PORT=3000
JWT_SECRET=your_jwt_secret_key_here
```

### 2.3 启动后端服务

1. 确保您在WSL终端中，而不是Windows CMD
2. 确认您在正确的目录中:
   ```bash
   pwd
   # 应该显示 /home/daivy/projects/full_stack/bottle/backend
   ```

3. 开发模式启动 (自动重启):
   ```bash
   npm run dev
   ```

4. 生产模式启动:
   ```bash
   npm start
   ```

后端服务将在 http://localhost:3000 上运行。

### 2.4 WSL环境特别注意事项

1. 如果您遇到路径问题，请确保使用Linux路径格式
2. 在WSL中，您可以使用 `explorer.exe .` 命令在Windows资源管理器中打开当前目录
3. 如果您需要从Windows访问WSL中运行的服务，请使用 `localhost` 或 `127.0.0.1`
4. 如果遇到端口占用问题，可以使用以下命令检查:
   ```bash
   sudo lsof -i :3000
   ```

## 3. 前端应用启动

### 3.1 使用Live Server

如果您使用VS Code，可以安装Live Server扩展:

1. 安装Live Server扩展
2. 在项目根目录右键点击index.html
3. 选择"Open with Live Server"

前端应用将在 http://localhost:5500 或类似端口上运行。

### 3.2 使用其他HTTP服务器

您也可以使用其他HTTP服务器:

1. 使用Python:
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000
```

2. 使用Node.js的http-server:
```bash
npx http-server -p 8000
```

## 4. 完整启动流程

1. 启动MySQL数据库服务
2. 创建数据库和表结构 (如上所述)
3. 启动后端API服务:
   ```bash
   cd backend
   npm install
   npm run dev
   ```
4. 启动前端应用:
   - 使用Live Server或其他HTTP服务器打开index.html

## 5. 测试应用

1. 打开浏览器访问前端应用
2. 尝试注册一个新账户
3. 登录后尝试创建和获取漂流瓶
4. 测试点赞、点踩和收藏功能

## 6. 故障排除

### 6.1 WSL环境路径问题

如果您在WSL中遇到类似以下的错误:
```
Error: Cannot find module 'C:\Windows\server.js'
```

这表明Node.js正在尝试从Windows目录而不是您的项目目录运行。解决方法:

1. 确保您在WSL终端中，而不是Windows CMD
2. 使用完整的Linux路径导航到项目目录:
   ```bash
   cd /home/daivy/projects/full_stack/bottle/backend
   ```
3. 验证您在正确的目录:
   ```bash
   pwd
   ls -la
   ```
4. 确保server.js文件存在于当前目录
5. 再次尝试运行:
   ```bash
   npm start
   ```

### 6.2 数据库连接问题

- 确保MySQL服务正在运行
- 检查.env文件中的数据库配置是否正确
- 确认数据库用户有足够的权限

### 6.2 API请求问题

- 检查后端服务是否正常运行
- 确认前端API请求URL是否正确 (默认为 http://localhost:3000/api)
- 查看浏览器开发者工具的网络选项卡，检查API请求和响应

### 6.3 CORS问题

如果遇到跨域问题，后端已配置CORS中间件，但仍需确认:
- 前端和后端使用不同的端口 (例如前端5500，后端3000)
- 检查后端日志中是否有CORS相关错误

## 7. 生产环境部署

在生产环境中，您可能需要:

1. 使用HTTPS协议
2. 配置更安全的JWT密钥
3. 使用数据库连接池
4. 配置反向代理 (如Nginx)
5. 设置适当的CORS策略
6. 使用环境变量管理敏感配置

## 8. 开发提示

1. 在开发过程中，可以使用开发者模式绕过每日限制
2. 可以通过修改前端代码中的API_BASE_URL来连接不同的后端服务
3. 使用浏览器开发者工具查看API请求和响应
4. 查看后端控制台日志获取更多信息
